(function(c,g,h,l,m,p){c(m).on("foundation-contentloaded",function(e){e=c(e.target);e.hasClass("cq-Dialog")&&e.find(".ac-Scene7-parameters").each(function(){function e(){var b=d.map(function(){var a=c(this).find(".coral-Form-fieldlabel").text(),b=c(this).find(".js-ac-scene7-input").val();return a+"\x3d"+b}).get().join("\x26");a.val(b)}var b=c(this),a=b.find(".js-ac-scene7-substitutions"),d=b.find(".coral-Form-fieldwrapper");d.each(function(){var a=c(this).find(".js-ac-scene7-input"),b=c(this).find(".js-ac-scene7-reset");
a.on("change keyup",e);b.click(function(){a.val(decodeURIComponent(c(this).attr("data-original-value")));e()})})})})})(jQuery,Granite,jQuery(document),this,document);(function(c,g){c(g).on("dialog-ready",function(){})})($,document);(function(c,g){c(g).on("dialog-ready",function(){})})($,document);
(function(c,g){function h(a){(a=c(a.target).val())&&"||"!=a||!n()?e(!1):e(!0)}function l(a){m(c(a.target).val())}function m(a){"image"==a?(c("#viewerPreset").parent().hide(),c("#imagePreset").parent().show(),c("#s7URLModifiers").parent().show(),c("#s7ViewerModifiers").parent().hide(),g.getElementById("s7ViewerModifiers").value="",d(c("#viewerPreset")),p(),e(!0)):"smartCrop"==a?(c("#viewerPreset").parent().hide(),c("#imagePreset").parent().hide(),c("#s7URLModifiers").parent().show(),c("#s7Breakpoints").parent().hide(),
c("#s7ViewerModifiers").parent().hide(),g.getElementById("s7ViewerModifiers").value="",d(c("#viewerPreset")),d(c("#imagePreset")),e(!0),f(!1)):(c("#viewerPreset").parent().show(),c("#imagePreset").parent().hide(),c("#s7URLModifiers").parent().hide(),g.getElementById("s7URLModifiers").value="",c("#s7Breakpoints").parent().hide(),c("#s7ViewerModifiers").parent().show(),d(c("#imagePreset")),e(!1),f(!0))}function p(){k(c("#imagePreset"),function(a){a?(c("#s7Breakpoints").parent().hide(),f(!0),c("#s7Breakpoints").val("")):
(c("#s7Breakpoints").parent().show(),f(!1))})}function e(a){a?(c("#dmLinkUrl").parent().show(),c("#dmLinkTarget").parent().show(),c("#dmAltText").parent().show()):(c("#dmLinkUrl").parent().hide(),c("#dmLinkTarget").parent().hide(),c("#dmAltText").parent().hide())}function f(a){a?(c("#dmHeight").parent().show(),c("#dmWidth").parent().show()):(c("#dmHeight").parent().hide(),c("#dmWidth").parent().hide())}function b(a,b){a.find('[type\x3d"radio"]').each(function(){c(this).prop("checked",c(this).val()==
b)})}function a(a,b){a=a.find('[type\x3d"radio"]');var d=b;a.each(function(){c(this).prop("checked")&&(d=c(this).val())});return d}function d(a){a.find("coral-select-item[selected]").removeAttr("selected");a.find("button").find("span").html("NONE")}function n(){return"Image"==c("#s7AssetType").val()}function k(a,b){var d=a.val();if(""==d)b(!0);else{var e="/conf/global/settings/dam/dm/presets/macros/"+d+".children.3.json";c.get(e,function(a){0<a.length?a[0].hei&&a[0].wid?b(!0):b(!1):(e="/etc/dam/imageserver/macros/"+
d+".children.3.json",c.get(e,function(a){0<a.length&&a[0].hei&&a[0].wid?b(!0):b(!1)}))})}}c(g).on("dialog-ready",function(){c("#s7PresetType").off("change",l);c("#imagePreset").off("change",p);c("#s7PresetType").on("change",l);c("#imagePreset").on("change",p);c("#viewerPreset").on("change",h);Coral.commons.ready(c("#s7PresetType").get(0),function(){var d=c("#viewerPreset").val(),f=c("#imagePreset").val(),k=c("#s7Breakpoints").val(),g=a(c("#s7PresetType"),"image");k=k?k.trim():k;if(n())if(d&&"||"!=
d)e(!1),m("viewer"),b(c("#s7PresetType"),"viewer");else{e(!0);if(f&&""!=f||k||"smartCrop"!=g)g="image";m(g);b(c("#s7PresetType"),g)}else c("#imagePreset").parent().hide(),c("#s7PresetType").parent().hide(),c("#s7URLModifiers").parent().hide(),c("#s7Breakpoints").parent().hide(),e(!1),b(c("#s7PresetType"),"viewer")})})})($,document);
(function(c,g){var h=function(c){var h;g.ajax({url:location.protocol+"//"+location.host+c+"/jcr:content.targetactivities.json",async:!1,success:function(c,e,f){"success"==e&&(h=c)}});return h};g(c).on("foundation-contentloaded.cq-siteadmin-admin-properties",function(){var l=g("coral-select[name\x3d'./cq:target-ambits']",g(this));if(0<l.length)l.on("change",function(m){if((m=(m=m.currentTarget&&m.currentTarget.selectedItem?m.currentTarget.selectedItem.value:void 0)?h(m):void 0)&&m.activities&&0<m.activities.length){m=
m.activities;var l=g(c.createElement("div")),e=g(c.createElement("p")).appendTo(l);1===m.length?e.text(Granite.I18n.get("Your change will affect the following activity which will be re-synced:")):e.text(Granite.I18n.get("Your change will affect the following activities which will be re-synced:",m.length));e=[];for(var f=Math.min(m.length,12),b=0;b<f;b++){var a=m[b]["jcr:title"]||m[b].path;e.push(g(c.createElement("b")).text(a).prop("outerHTML"))}m.length>f&&e.push("\x26#8230;");g(c.createElement("p")).html(e.join("\x3cbr\x3e")).appendTo(l);
g(window).adaptTo("foundation-ui").prompt(Granite.I18n.get("Affected activities"),l.html(),"notice",[{text:Granite.I18n.get("Close")}])}})})})(document,Granite.$);
(function(c,g,h){function l(){var a=h.Deferred();h.get(g.HTTP.externalize(E.dataset.effectiveAclSrc),{_dc:(new Date).getTime()}).done(function(b){var d=h.parseHTML(b);Coral.commons.ready(E,function(){var b,c;for(b=0;b<d.length;b++){var e=d[b];if(e.querySelector&&(c=e.querySelector(".foundation-collection")))break}c&&(c.classList.contains("list")||c.classList.add("list"),E.content.innerHTML=null,E.content.appendChild(c));c=E.content.querySelectorAll(".shortenpath");for(b=0;b<c.length;b++)e=h(c[b]),
e.data("shortened")||((new g.UI.Shortener(e)).shorten(),e.data("shortened",!0));a.resolve()})});return a.promise()}function m(a,b,d){if(a=a.querySelector(b))a.checked=d}function p(a){var b=a.currentTarget;if(a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--read")){if(!a.target.checked){var d=b.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");if(d)for(var c=0;c<d.length;c++)d[c].checked=!1}}else a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--modify")?
a.target.checked||(b.querySelector(".js-cq-sites-PermissionsProperties-acl--delete").checked=!1):a.matchedTarget.classList.contains("js-cq-sites-PermissionsProperties-acl--delete")&&a.target.checked&&(b.querySelector(".js-cq-sites-PermissionsProperties-acl--modify").checked=!0);a.target.checked&&(a=b.querySelector(".js-cq-sites-PermissionsProperties-acl--read"))&&(a.checked=!0)}function e(a,b){m(a,".js-cq-sites-PermissionsProperties-acl--read",b.read);m(a,".js-cq-sites-PermissionsProperties-acl--modify",
b.modify);m(a,".js-cq-sites-PermissionsProperties-acl--delete",b["delete"]);m(a,".js-cq-sites-PermissionsProperties-acl--replicate",b.replicate);m(a,".js-cq-sites-PermissionsProperties-acl--create",b.create);b=!a.querySelector(".js-cq-sites-PermissionsProperties-acl input[type\x3d'checkbox']:checked");a.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit").disabled=b}function f(a){if(a&&!a.querySelector(".js-cq-sites-PermissionsProperties-row--empty")){var b=a.querySelector("tbody");b||(b=document.createElement("tbody",
"coral-table-body"),a._elements.table.appendChild(b));b.appendChild(h(U(J))[0])}}function b(a){var b=a.target.closest(".js-cq-sites-PermissionsProperties-row"),d=JSON.parse(b.dataset.acl);Q.prompt(z.deletePermissionsTitle,z.deletePermissionsDescription,"error",[{text:z.cancel,id:"no"},{text:z.deleteText,id:"yes",warning:!0}],function(a){"yes"===a&&(a={type:"POST",data:{principalName:d.principalName,path:g.HTTP.encodePath(y),action:"remove",_charset_:"UTF-8"},complete:function(a,d){"success"===d&&
(a=b.closest("table[is\x3d'coral-table']"),h(b).remove(),a&&1>a.items.length&&f(a))}},h.ajax(g.HTTP.externalize(y+".pagepermissions.conf"),a))})}function a(a,b){return{name:a,value:b[a]}}function d(b){var d=[];d.push(a("read",b));d.push(a("modify",b));d.push(a("delete",b));d.push(a("replicate",b));d.push(a("create",b));return d}function n(a,b){return a.querySelector(".js-cq-sites-PermissionsProperties-acl--"+b).checked}function k(a){if(a=A.querySelectorAll(".js-cq-sites-CreatePermissionsDialog-authorizableList coral-taglist[foundation-autocomplete-value] coral-tag")){for(var b=
[],d=0;d<a.length;d++){var c=a[d],e=c.label.innerText.trim();b.push({principalName:c.dataset.foundationAutocompleteCustomPrincipalname,avatar:c.dataset.foundationAutocompleteCustomImage,label:e,read:n(A,"read"),modify:n(A,"modify"),"delete":n(A,"delete"),replicate:n(A,"replicate"),create:n(A,"create"),hasAclEdit:!0})}K(b)}}function q(a){if(a=N.querySelectorAll(".js-cq-sites-CUGPermissionsDialog-authorizableList coral-taglist[foundation-autocomplete-value] coral-tag")){for(var b=[],d=0;d<a.length;d++){var c=
a[d],e=c.label.innerText.trim();b.push({principalName:c.dataset.foundationAutocompleteCustomPrincipalname||e,avatar:c.dataset.foundationAutocompleteCustomImage||"/libs/granite/security/clientlib/themes/default/resources/sample-group-thumbnail.36.png",label:e,read:!0,modify:!1,"delete":!1,replicate:!1,create:!1,hasAclEdit:!0})}w(b)}}function F(a){var b=[];a=document.querySelectorAll(a);for(var d=0;d<a.length;d++){var c=a[d].dataset.acl;c&&(c=JSON.parse(c),b.push({principalName:c.principalName,avatar:c.avatar,
label:c.label,read:c.read,modify:c.modify,"delete":c["delete"],replicate:c.replicate,create:c.create,hasAclEdit:c.hasAclEdit}))}return b}function w(a){var b,d,c=[];a=a||[];for(b=0;b<a.length;b++)c.push(a[b].principalName);var e=F(".js-cq-sites-PermissionsProperties-row--closedUserGroup");for(b=0;b<e.length;b++)c.push(e[b].principalName);var k=!1;1>c.length&&(k=!0,c.push(""));c={type:"POST",data:{principalNames:c,_charset_:"UTF-8"},complete:function(c,n){if("success"===n)if(1>e.length&&(!a||1>a.length))f(document.querySelector(".js-cq-sites-ClosedUserGroup-permissions"));
else for(k||(c=x.querySelector("tbody tr:not(.js-cq-sites-PermissionsProperties-row)"))&&c.parentNode.removeChild(c),b=0;b<a.length;b++){c=!1;n=a[b];for(d=0;d<e.length;d++)if(n.principalName===e.principalName){c=!0;break}c||t(x,n,".js-cq-sites-PermissionsProperties-row--closedUserGroup",".js-cq-sites-ClosedUserGroup-permissions .js-cq-sites-PermissionsProperties-row--empty",O)}}};h.ajax(g.HTTP.externalize(y+".cugpolicy.conf"),c)}function D(a){Q.prompt(z.deleteCUGEntryTitle,z.deleteCUGEntryDescription,
"error",[{text:z.cancel,id:"no"},{text:z.deleteText,id:"yes",warning:!0}],function(b){"yes"===b&&(b=a.target.closest(".js-cq-sites-PermissionsProperties-row--closedUserGroup"),b.parentNode.removeChild(b),w())})}function G(a){N||(N=document.querySelector(".js-cq-sites-CUGPermissionsDialog"),N.on("click",".js-cq-sites-CUGPermissionsDialog-save",q));N.setAttribute("open","");(a=document.querySelector(".js-cq-sites-CUGPermissionsDialog-authorizableList"))&&a.clear()}function H(a){A||(A=document.querySelector(".js-cq-sites-CreatePermissionsDialog"),
A.on("click",".js-cq-sites-CreatePermissionsDialog-add",k),A.on("click",".js-cq-sites-PermissionsProperties-acl",p));A.setAttribute("open","");a=A;var b=document.querySelector(".js-cq-sites-CreatePermissionsDialog-authorizableList");b&&b.clear();b=a.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");for(var d=0;d<b.length;d++)b[d].checked=!1;a.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit").disabled=!0}function R(a){var b=a.target.closest(".js-cq-sites-PermissionsProperties-row"),
d=JSON.parse(b.dataset.acl);B||(B=document.querySelector(".js-cq-sites-EditPermissionsDialog"),B.on("click",".js-cq-sites-PermissionsProperties-acl",p));B.off("click",".js-cq-sites-EditPermissionsDialog-update").on("click",".js-cq-sites-EditPermissionsDialog-update",function(){K([{principalName:d.principalName,avatar:d.avatar,label:d.label,read:n(B,"read"),modify:n(B,"modify"),"delete":n(B,"delete"),replicate:n(B,"replicate"),create:n(B,"create"),hasAclEdit:!0}])});B.setAttribute("open","");e(B,d);
return u(a)}function K(a){var b,c=[],e=L.items.getAll(),f={};for(b=0;b<e.length;b++){var k=e[b];k.dataset.acl&&(k=JSON.parse(k.dataset.acl),f[k.principalName]=k,c.push({principalName:k.principalName,privileges:d(k)}))}if(a)for(b=0;b<a.length;b++){k=a[b];for(var n=!1,q=0;q<c.length;q++)if(k.principalName===c[q].principalName){f[k.principalName]=k;c[q]={principalName:k.principalName,privileges:d(k)};n=!0;break}n||(f[k.principalName]=k,c.push({principalName:k.principalName,privileges:d(k)}))}a={predicate:"siteadmin",
path:g.HTTP.encodePath(y),changelog:JSON.stringify(c),contentType:"application/json; charset\x3dutf-8",action:"edit",_charset_:"UTF-8"};h.post(g.HTTP.externalize(y+".pagepermissions.conf"),a,function(a,b){if("success"===b&&a.changelog){a=a.changelog;for(b=0;b<a.length;b++){var d=a[b],c;for(c in f)if(f.hasOwnProperty(c)&&c===d.principalName){var k=f[c];k.read=d.privileges.read||!1;k.modify=d.privileges.modify||!1;k["delete"]=d.privileges["delete"]||!1;k.replicate=d.privileges.replicate||!1;k.create=
d.privileges.create||!1}}h(e).remove();if(f)for(var n in f)f.hasOwnProperty(n)&&t(L,f[n],".js-cq-sites-PermissionsProperties-row",".js-cq-sites-UserGroup-permissions .js-cq-sites-PermissionsProperties-row--empty",S);r()}})}function t(a,b,d,c,e){b.data=JSON.stringify(b);var k=a.querySelector(c);k&&(c=k.parentNode,c.removeChild(k));c=a.querySelectorAll(d);for(d=0;d<c.length;d++)if(k=JSON.parse(c[d].dataset.acl),b.principalName===k.principalName){a=c[d];b=h(S(b))[0];a.parentElement.replaceChild(b,a);
return}b=h(e(b))[0];a.items.add(b)}function v(){S=function(a){return'\x3ctr is\x3d"coral-table-row" class\x3d"js-cq-sites-PermissionsProperties-row" data-acl\x3d\''+a.data+'\'\x3e\n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-labelColumn"\x3e \n                          \x3cimg class\x3d"cq-sites-Permissions-thumbnail" src\x3d"'+a.avatar+'"/\x3e\n                          \x3cspan class\x3d"cq-sites-Permissions-label"\x3e'+a.label+'\x3c/span\x3e \n                      \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+
(a.read?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.modify?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.delete?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+
(a.replicate?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e '+(a.create?'\x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e':"")+' \x3c/td\x3e \n                      \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-actions"\x3e \n                          \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"edit"  \n                                  class\x3d"js-cq-sites-PermissionsProperties-edit"\x3e\x3c/button\x3e \n                          \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"delete" \n                                  class\x3d"js-cq-sites-PermissionsProperties-delete"\x3e\x3c/button\x3e \n                      \x3c/td\x3e \n                  \x3c/tr\x3e'};
O=function(a){return'\x3ctr is\x3d"coral-table-row"  \n                       class\x3d"js-cq-sites-PermissionsProperties-row js-cq-sites-PermissionsProperties-row--closedUserGroup"  \n                       data-acl\x3d\''+a.data+'\'\x3e\n                        \x3ctd is\x3d"coral-table-cell"\x3e \n                            \x3cimg class\x3d"cq-sites-Permissions-thumbnail" src\x3d"'+(a.avatar?a.avatar:"")+'"/\x3e\n                            \x3cspan class\x3d"cq-sites-Permissions-label"\x3e '+
a.label+' \x3c/span\x3e \n                        \x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e \n                            \x3ccoral-icon icon\x3d"check"\x3e\x3c/coral-icon\x3e \n                        \x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-checkColumn"\x3e\x3c/td\x3e \n                        \x3ctd is\x3d"coral-table-cell" class\x3d"cq-sites-Permissions-actions"\x3e \n                            \x3cbutton is\x3d"coral-button" type\x3d"button" variant\x3d"quiet" icon\x3d"delete"  \n                                    class\x3d"js-cq-sites-ClosedUserGroup-delete"\x3e\x3c/button\x3e \n                        \x3c/td\x3e \n                    \x3c/tr\x3e'};
U=function(a){return'\x3ctr is\x3d"coral-table-row" class\x3d"js-cq-sites-PermissionsProperties-row--empty"\x3e \n                     \x3ctd is\x3d"coral-table-cell" colspan\x3d"7" alignment\x3d"center"\x3e '+a.label+" \x3c/td\x3e \n                   \x3c/tr\x3e"}}function M(){E||(E=document.querySelector(".js-cq-sites-EffectivePermissionsDialog"));l().then(function(){E.setAttribute("open",!0)})}function C(a){var b=a.target.closest("coral-dialog");if(b){a=b.querySelectorAll(".js-cq-sites-PermissionsProperties-acl");
b=b.querySelector(".js-cq-sites-PermissionsDialog-aclSubmit");for(var d=!0,c=0;c<a.length;c++)if(a[c].checked){d=!1;break}b.disabled=d}}function P(){var a=document.querySelector("[data-deprecated-cugconfig]"),b=document.querySelector(".js-cq-sites-ClosedUserGroupDialog-show");a&&b&&(b.disabled=!0)}function u(a){a.preventDefault();a.stopPropagation();h(".coral-Table-row--placeholder").remove();return!1}function r(){h(".js-cq-sites-PermissionsProperties-edit").on("mousedown",u);h(".js-cq-sites-PermissionsProperties-edit").on("mouseup",
u);h(".js-cq-sites-PermissionsProperties-delete").on("mousedown",u);h(".js-cq-sites-PermissionsProperties-delete").on("mouseup",u)}var z={deletePermissionsTitle:g.I18n.get("Delete permission"),deletePermissionsDescription:g.I18n.get("Do you really want to delete permissions for this user/group?"),deleteCUGEntryTitle:g.I18n.get("Delete Closed User Group entry"),deleteCUGEntryDescription:g.I18n.get("Do you really want to remove the entry from the Closed User Group?"),cancel:g.I18n.get("Cancel"),deleteText:g.I18n.get("Delete"),
permissionsEmptyRowLabel:g.I18n.get("There is no item.")},Q=h(window).adaptTo("foundation-ui"),B,A,N,E,S,O,J={label:z.permissionsEmptyRowLabel},U,L,x,y,I;c.one("foundation-contentloaded",function(a){a=h(".js-cq-sites-PermissionsProperties");0<a.length&&(r(),a.on("click",".js-cq-sites-PermissionsProperties-edit",R),a.on("click",".js-cq-sites-PermissionsProperties-delete",b),a.on("click",".js-cq-sites-ClosedUserGroup-delete",D),a.on("coral-table:roworder",".js-cq-sites-UserGroup-permissions",function(){K()}),
c.on("click",".js-cq-sites-AddPermissionsDialog-show",H),c.on("click",".js-cq-sites-ClosedUserGroupDialog-show",G),c.on("click",".js-cq-sites-EffectivePermissionsDialog-show",M),c.on("click",".js-cq-sites-PermissionsProperties-acl",C),y=document.querySelector(".js-cq-sites-PermissionsProperties-pagePath").value,I=void 0!==document.querySelector(".js-cq-sites-PermissionsProperties-userAcl").dataset.userAclEdit,x=document.querySelector(".js-cq-sites-ClosedUserGroup-permissions"),L=document.querySelector(".js-cq-sites-UserGroup-permissions"),
L.orderable=I,v(),P())})})($(document),Granite,Granite.$);
(function(c,g,h,l){function m(b){var a=b;a.classList.contains("coral-TagList")||(a=l(b).parents(".coral-PathBrowser.js-cq-TagsPickerField").nextAll(".coral-TagList.js-TagsPickerField-tagList")[0]);return a}function p(b,a){var d=a.data("fieldname"),c=a.find("input[name\x3d'"+d+"'][value\x3d'"+b.tagID+"']"),e=a.hasClass("cq-TagList--patchMode")?"+"+b.tagID:b.tagID;if(0===c.length){c=l('\x3cli role\x3d"option" aria-selected\x3d"true" class\x3d"coral-TagList-tag coral-TagList-tag--multiline"/\x3e').attr("title",b.titlePath);
var f=l('\x3cbutton class\x3d"coral-MinimalButton coral-TagList-tag-removeButton" type\x3d"button"/\x3e').attr("title",h.I18n.get("Remove")),g=l('\x3ci class\x3d"coral-Icon coral-Icon--sizeXS coral-Icon--close"/\x3e');b=l('\x3cspan class\x3d"coral-TagList-tag-label"\x3e').text(b.titlePath);d=l('\x3cinput type\x3d"hidden"/\x3e').attr("name",d).attr("value",e);f.append(g);c.append(f).append(b).append(d);a.append(c);a.trigger("itemadded")}}c=l(c).adaptTo("foundation-registry");var e,f=[".coral-PathBrowser.js-cq-TagsPickerField + .coral-TagList.js-TagsPickerField-tagList",
".coral-PathBrowser.js-cq-TagsPickerField .coral-InputGroup-input.js-coral-pathbrowser-input"];c.register("foundation.adapters",{type:"foundation-field",selector:".coral-TagList.js-TagsPickerField-tagList",adapter:function(b){var a=l(b).prevAll(".coral-PathBrowser.js-cq-TagsPickerField").find(".coral-InputGroup-input.js-coral-pathbrowser-input")[0];if(a)return{isRequired:function(){return a.required},setRequired:function(b){a.required=b}}}});c.register("foundation.validation.validator",{selector:f.join(", "),
validate:function(b){b=m(b);if(b.hasAttribute("aria-required")&&0===b.querySelectorAll(".coral-TagList-tag").length)return e||(e=h.I18n.get("Please fill out this field.")),e},show:function(b,a){b=l(m(b));var d=b.adaptTo("foundation-field");d&&d.setRequired&&d.setRequired(!0);b.nextAll(".coral-Form-fieldinfo").addClass("u-coral-screenReaderOnly");if(d=b.data("foundation-validation.internal.error")){var c=l(d).data("foundation-validation.internal.error.tooltip");c.content.innerHTML=a;d.parentNode||
b.after(d,c)}else d=new Coral.Icon,d.icon="alert",d.classList.add("coral-Form-fielderror"),c=new Coral.Tooltip,c.variant="error",c.placement=b.closest("form").hasClass("coral-Form--vertical")?"left":"bottom",c.target=d,c.content.innerHTML=a,l(d).data("foundation-validation.internal.error.tooltip",c),b.data("foundation-validation.internal.error",d),b.after(d,c)},clear:function(b){b=l(m(b));var a=b.adaptTo("foundation-field");a&&a.setRequired&&a.setRequired(!1);if(a=b.data("foundation-validation.internal.error")){var d=
l(a).data("foundation-validation.internal.error.tooltip");d.hide();d.remove();a.remove()}b.nextAll(".coral-Form-fieldinfo").removeClass("u-coral-screenReaderOnly")}});CUI.PathBrowser.register("optionLoader",{name:"cq.tagbrowser.optionloader",handler:function(b,a){l.get(this.$element.data("browserpath")+".tags.json",{suggestByTitle:b,rootPath:this.$element.data("root-path"),start:0,limit:50,count:!1,_charset_:"UTF-8",replicationStateRequired:!1},function(b){b=b.tags;for(var d=[],c=0;c<b.length;c++)d.push(b[c]);
a&&a(d)},"json");return!1}});CUI.PathBrowser.register("optionValueReader",{name:"cq.tagbrowser.optionValueReader",handler:function(b){return b.path}});CUI.PathBrowser.register("optionTitleReader",{name:"cq.tagbrowser.optionTitleReader",handler:function(b){return b.titlePath}});CUI.PathBrowser.register("optionRenderer",{name:"cq.tagbrowser.optionRenderer",handler:function(b,a){b=this.options.options[a];var d="";this.options.showTitles&&this.options.optionDisplayStrings[a]&&0<this.options.optionDisplayStrings[a].length&&
(d=this.options.optionDisplayStrings[a]);return l("\x3cli\x3e",{"class":"coral-SelectList-item coral-SelectList-item--option","data-value":b}).text(d)}});CUI.PathBrowser.register("autocompleteCallback",{name:"cq.tagbrowser.autocompleteCallback",handler:function(b){var a=this,d=l.Deferred();if(a.options.optionLoader){var c={loadOptions:a.optionLoader},e=l.Deferred();e.promise(c);c.done(function(b){l.isFunction(b.promise)?b.done(function(b){a._rebuildOptions(d,"",b)}):a._rebuildOptions(d,"",b)});(b=
c.loadOptions(b,function(a){e.resolve(a)}))&&e.resolve(b)}return d.promise()}});l(g).on("click",".js-cq-TagsPickerField ~ .coral-TagList .coral-TagList-tag-removeButton",function(b){b=l(b.target).closest(".coral-TagList-tag");var a=b.parent(".coral-TagList");b.remove();a.trigger("itemremoved")});l(g).on("itemremoved",".cq-TagList--patchMode",function(b,a){b=l(this);var d=b.data("fieldname");a=a.value.replace("+","-");a=l('\x3cinput type\x3d"hidden" name\x3d"'+d+'" value\x3d"'+a+'"/\x3e');b.append(a)});
l(g).on("itemadded itemremoved",f[0],function(){var b=l(this).adaptTo("foundation-validation");b&&(b.checkValidity(),b.updateUI())});l(g).on("foundation-contentloaded",function(b){l(b.target).find(".js-cq-TagsPickerField.coral-PathBrowser").each(function(){var a=l(this).data("pathBrowser");a.$picker.off("coral-pathbrowser-picker-confirm.tagspicker").on("coral-pathbrowser-picker-confirm.tagspicker",function(b){b=a.inputElement;var d=l(this).find(".coral-ColumnView").data("columnView").getSelectedItems();
0<d.length&&(l.each(d,function(){var b=this.item,d=a.$element.siblings(".coral-TagList.js-TagsPickerField-tagList");b={titlePath:b.data("titlepath"),tagID:b.data("id")};p(b,d)}),l(b).val(""),l(".coral-ColumnView-item.is-active.is-selected",l(this)).toggleClass("is-active is-selected"))});a.dropdownList.off("selected.tagspicker").on("selected.tagspicker",function(a){var b=l(this).closest(".js-cq-TagsPickerField.coral-PathBrowser");l.get(a.selectedValue+".tag.json",{},function(a){if(void 0!==a){var d=
b.siblings(".coral-TagList.js-TagsPickerField-tagList");p(a,d);b.find(".js-coral-pathbrowser-input").val("")}else b.addClass("is-invalid"),b.focus()},"json")});a.inputElement.off("keypress.tagspicker").on("keypress.tagspicker",function(a){var b=l(this).closest(".js-cq-TagsPickerField.coral-PathBrowser");13===a.keyCode&&(a.preventDefault(),a=b.siblings(".coral-TagList.js-TagsPickerField-tagList"),b={titlePath:l(this).val(),tagID:l(this).val()},a.data("allowcreate")&&p(b,a),l(this).val(""))})})})})(window,
document,Granite,Granite.$);
(function(c,g,h,l){function m(e,f){c('[handle\x3d"remove"]',e).off("click").on("click",function(b){b.stopPropagation();b="\x3cp\x3e"+g.I18n.get("You are removing styles that might be used by one or more components on one or more pages.");b=b+"\x3cbr/\x3e"+g.I18n.get("This might lead to style changes on pages based on templates using this policy.");b+="\x3c/p\x3e";p.prompt(g.I18n.get("Delete Styles"),b,"notice",[{text:g.I18n.get("Cancel")},{text:g.I18n.get("Delete"),warning:!0,handler:function(){e.remove();
f.trigger("change")}}])})}var p=c(window).adaptTo("foundation-ui");l.on("dialog-ready",function(){c(".cq-AllowedStyles-multifield").each(function(e,f){Coral.commons.ready(f,function(b){c("coral-multifield-item",b).each(function(a,d){Coral.commons.ready(d,function(a){m(a,b)})});b.on("change",function(){c("coral-multifield-item",b).each(function(a,d){Coral.commons.ready(d,function(a){var d=c(".cq-AllowedStyles-styleId",a);d.val()||d.val(Date.now());m(a,b)})})})})})});l.on("coral-select:showitems",".cq-DefaultElement-selection",
function(e){e=e.currentTarget;var f=c(e).find("button").outerHeight(!0);f=e.items.length*(f+5);var b=parseInt(c(e).find("coral-selectlist").css("max-height"),10);f=Math.min(f,b);c(e).css("margin-bottom",f)});l.on("coral-select:hideitems",".cq-DefaultElement-selection",function(e){c(e.currentTarget).css("margin-bottom",0)})})(jQuery,Granite,Granite.author,jQuery(document));
(function(c,g,h,l,m,p){h.on("foundation-contentloaded",function(){h.find(".js-cq-DropArea").each(function(){var e=c(this);var f=e.hasClass("js-cq-DropArea--image")?Granite.I18n.get("Drop an image"):Granite.I18n.get("Drop an asset");var b=c('\x3cspan class\x3d".cq-DropArea-placeholder"\x3e'+f+"\x3c/span\x3e"),a=c('\x3cimg class\x3d"cq-DropArea-thumbnail"/\x3e');e.empty();e.append(b);e.append(a);e.on("assetSelected",function(d){d.silent&&d.stopImmediatePropagation();d=d.path;b&&0<b.length&&b.toggle(!(d&&
0<d.length));a&&0<a.length&&a.attr("src",d||"")})})})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,g,h,l,m,p){function e(a,b){if(a&&a.name&&0<a.name.length){var d=(new RegExp(/([a-zA-Z0-9_-]+)/)).exec(a.name);if(d&&1<d.length){var e="js-cq-DropArea-param-"+d[1];d="./"+a.name;P.find("."+e).remove();e=c('\x3cspan class\x3d"'+e+'"\x3e\x3c/span\x3e');b?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'@Delete" value\x3d"true"\x3e'):(a.title?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/jcr:title" value\x3d"'+a.title+'"\x3e'):e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/jcr:title@Delete" value\x3d"delete"\x3e'),
a.fileReference?e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/fileReference" value\x3d"'+a.fileReference+'"\x3e'):e.append('\x3cinput type\x3d"hidden" name\x3d"'+d+'/fileReference@Delete" value\x3d"delete"\x3e'));P.append(e)}}}function f(a){if(a){a=a instanceof jQuery?a:c(a);var b=new RegExp(/([0-9]+)$/);var d=a.data("name");b=b.exec(d);var f;b&&(f=parseInt(b[1]));b=a.data("fileReference");var k=a.text();if(k===K||k===b)k="";d={id:f,name:d,title:k,path:a.data("path"),fileReference:b,mimeType:a.data("dataAssetMimetype")};
e(d)}return d}function b(){var a=M++;return{id:a,name:"image"+a,title:"",path:"",fileReference:"",mimeType:""}}function a(a){t=[];var d=a.items.getAll(),c=d.length;if(0<c){for(a=0;a<c;a++){var e=f(d[a]);t.push(e)}v=t[0]}else v=e=b(),t.push(e),D(e),a.value=e.name;d=-1;for(c=0;c<t.length;c++)d<t[c].id&&(d=t[c].id);M=d+1}function d(a){for(var b=0;b<t.length;b++)if(a.name===t[b].name)return b;return-1}function n(a){for(var b=u.items.getAll(),d=0,c=b.length;d<c;d++){var e=b[d];if(a===e.value)return e}}
function k(a){a&&a.name?v=a:(a=a&&0<a.length?n(a):u.items.first(),v=f(a));u.value=v.name;q(v);e(v)}function q(a){z.value=a&&a.title?a.title:"";r.trigger(c.Event("assetSelected",{path:a&&a.fileReference?a.fileReference:"",silent:!0}))}function F(a){return a.title&&0<a.title.length?a.title:a.fileReference&&0<a.fileReference?a.fileReference:K}function w(a,b){if(!b||0>b)b=d(a);-1===b?(t.push(a),b=t.length-1,D(a,b)):(b=n(a.name))&&a&&(b.content&&(b.content.textContent=F(a)),b.value=a.name,b.dataset&&(b.dataset.name=
a.name,b.dataset.path=a.path,b.dataset.fileReference=a.fileReference,b.dataset.dataAssetMimetype=a.mimeType));u.value=a.name;e(a)}function D(a,b){if(!n(a.name)){var d=u.items.getAll(),e;c.isNumeric(b)&&b<u.items.length&&(e=d[b]);b=u.items.add(R(a),e);b.dataset.name=a.name;b.dataset.path=a.path;b.dataset.fileReference=a.fileReference;b.dataset.dataAssetMimetype=a.mimeType;u.value=a.name}}function G(){var a=b();t.push(a);D(a);k(a);e(v)}function H(){var a=d(v);if(0<=a){var c=t.splice(a,1)[0];var f=u.items.length;
if(c&&a<f){0<t.length?f=0<a?a<t.length-1?t[a]:t[a-1]:t[0]:(f=b(),t.push(f),D(f));f&&f.path&&0<f.path.length&&(u.value=f.name);var g=u.items.getAll();u.items.remove(g[a]);k(f);e(c,!0)}}}function R(a){return{content:{textContent:F(a)},value:a.name}}var K=Granite.I18n.get("New slide"),t=[],v,M=0,C,P=c('\x3cspan class\x3d"js-cq-DropArea-params"\x3e\x3cinput type\x3d"hidden" name\x3d"_charset_" value\x3d"utf-8" /\x3e\x3c/span\x3e'),u,r,z;h.on("foundation-contentloaded",function(){C=c(".js-cq-Slideshow-content").eq(0);
if(0<C.length){M=0;u=C.find(".js-cq-Slideshow-select")[0];var b=C.find(".js-cq-Slideshow-add")[0],e=C.find(".js-cq-Slideshow-delete")[0];z=C.find(".js-cq-Slideshow-name")[0];r=C.find(".js-cq-Slideshow-dropArea").eq(0);0===C.find(".js-cq-DropArea-params").length&&C.prepend(P);a(u);q(v);b.on("click",G);e.on("click",H);r.on("assetSelected",function(a){v.path="";v.fileReference=a.path;v.mimeType=a.mimetype;w(v)});C.on("blur keyup",".js-cq-Slideshow-name",function(a){v.title=a.target.value;a=d(v);a<=t.length&&
w(v,a)});u.on("change",function(a){a.target.selectedItem&&k(a.target.selectedItem.value)})}})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,g,h){function l(c,f){var b=f.editorKernel;f.sourceEditMode&&b.fireUIEvent("disablesourceedit");b.hasBackgroundToolbar(c)||b.addBackgroundToolbar({tbType:c,isFullScreen:b.getEditContext().getState("fullscreenadapter").isFullScreen(),useFixedInlineToolbar:!0});b.setActiveToolbar(c)}var m=function(c,f){var b=c.data("editorType");f=c.data("externalStyleSheets");var a;if("table"===b){var d={useColPercentage:!1,rtePlugins:{table:{features:"*",defaultValues:{width:"100%"},editMode:CUI.rte.plugins.TablePlugin.EDITMODE_TABLE}}};
var e=function(a){return Granite.Util.applyDefaults({},d,a)}}var k=new CUI.RichText({element:c,componentType:b,preventCaretInitialize:!0});if(f&&0<f.length)for(f=f.split(","),b=0;b<f.length;b++){var g=h("head link[href\x3d'"+f[b]+"']");0>=g.length&&(g=h('\x3clink rel\x3d"stylesheet" href\x3d"'+f[b]+'" type\x3d"text/css"\x3e'),h("head").append(g),(a=c.data("externalStyleElements"))?a.push(g):a=[g],c.data("externalStyleElements",a))}CUI.rte.ConfigUtils.loadConfigAndStartEditing(k,c,e)};h(g).on("foundation-contentloaded",
function(c){var e=h(c.target).hasClass(".cq-RichText")?h(c.target):h(c.target).find(".cq-RichText");e.each(function(){var a=h(this);a.closest(".cq-RichText-FixedColumn-column").addClass("coral-RichText-FixedColumn-column");a.closest(".coral-RichText-FixedColumn-column:not(.cq-RichText-FixedColumn-column)").addClass("cq-RichText-FixedColumn-column")});e.each(function(){var a=h(this),b=a.find(".cq-RichText-editable");if(!b.data("rteinstance")){var c=a.find("input[type\x3d'hidden'][data-cq-richtext-input\x3d'true']").val();
b.empty().append(c)}a.on("keypress","input",function(a){13===a.keyCode&&a.preventDefault()})});e.on("change","[data-cq-richtext-editable\x3d'true']",function(){var a=h(this).closest(".cq-RichText"),b=a.find(".cq-RichText-editable").data("rteinstance");a.find("input[type\x3dhidden][data-cq-richtext-input\x3d'true']").val(b.getContent())});var b=h(c.target).find(".cq-RichText\x3e.cq-RichText-editable");b.each(function(){var a=h(this);if(a.data("customStart"))a.on("rte-start",function(){var a=h(this);
if(a.data("useFixedInlineToolbar")&&!a.data("rteinstance")){var b=h(this).parent().find("input[type\x3dhidden][data-cq-richtext-input\x3d'true']").val();a.empty().append(b);m(a)}});else a.data("useFixedInlineToolbar")&&!a.data("rteinstance")&&m(a);a.on("editing-start",function(){var a=h(this).data("rteinstance"),b=h(this),c=b.closest("coral-dialog");a.editorKernel.getToolbar().hide();c.length&&!0===c[0].fullscreen&&l("dialogFullScreen",a);b.closest("coral-dialog-content").on("click",function(b){b=
h(b.target);b.closest(".cq-RichText").length||(CUI.rte.Common.ua.isSafari&&b.is("input[type\x3d'radio'], input[type\x3d'checkbox']")&&(b=a.editorKernel.getEditContext(),CUI.rte.Selection.getSelection(b).removeAllRanges()),a.useFixedInlineToolbar&&!a.sourceEditMode&&a.editorKernel.toolbar.hide())})});h(this).on("click",function(){var a=this;b.each(function(){var b=h(this).data("rteinstance");this!==a&&b&&!b.sourceEditMode&&b.editorKernel.getToolbar().hide()})})})});var p=function(){var c=h(this);var f=
c.data("rteinstance");var b=c.data("externalStyleElements");if(f){f.finish(!1);if(b)for(f=0;f<b.length;f++)b[f].remove();c.removeData("rteinstance")}};h(g).on("dialog-beforeclose",".cq-Dialog",function(c){h(c.target).hasClass("cq-Dialog")&&h(this).find(".cq-RichText\x3e.cq-RichText-editable").each(p)});h(g).on("dialog-layouttoggle-fullscreen",".cq-Dialog",function(c){h(c.target).find(".cq-RichText\x3e.cq-RichText-editable").each(function(){var c=h(this).data("rteinstance");c&&l("dialogFullScreen",
c)})});h(g).on("dialog-layouttoggle-floating",".cq-Dialog",function(c){h(c.target).find(".cq-RichText\x3e.cq-RichText-editable").each(function(){var c=h(this).data("rteinstance");c&&l("inline",c)})});h(g).on("click",".coral-Wizard-nextButton",function(c){h(this).closest(".foundation-form").find(".cq-RichText\x3e.cq-RichText-editable").each(p)});CUI.rte.Theme.BLANK_IMAGE=Granite.HTTP.externalize("/libs/clientlibs/granite/richtext/resources/images/blank.png")})(window,document,Granite.$);
(function(c,g,h){function l(c){if(c=c.adaptTo("foundation-validation"))c.checkValidity(),c.updateUI()}var m;c=h(c).adaptTo("foundation-registry");c.register("foundation.adapters",{type:"foundation-field",selector:".cq-RichText,.cq-RichText-editable",adapter:function(c){var e=c.querySelector(".cq-RichText-editable");if(e)return{isInvalid:function(){return e.hasAttribute("invalid")},setInvalid:function(c){c?e.setAttribute("invalid",""):e.removeAttribute("invalid")},getName:function(){return e.getAttribute("name")},
setName:function(f){c.querySelector("input[type\x3d'hidden'][data-cq-richtext-input\x3d'true']").name=f;e.setAttribute("name",f)}}}});c.register("foundation.validation.selector",{submittable:".cq-RichText,.cq-RichText-editable",candidate:".cq-RichText,.cq-RichText-editable"});c.register("foundation.validation.validator",{selector:".cq-RichText,.cq-RichText-editable",validate:function(c){c=h(c).find(".cq-RichText-editable").addBack(".cq-RichText-editable");var e;if(c.data("rteinstance").sourceEditMode)return Granite.I18n.get("Please exit Source-edit mode before saving the changes");
if("true"===c.attr("aria-required")&&(c.data("rteinstance")&&(e=c.data("rteinstance").getContent()),void 0===e&&(e=c.html()),0===e.length))return m||(m=Granite.I18n.get("Please fill out this field.")),m}});h(g).on("foundation-contentloaded",function(c){h(c.target).find(".cq-RichText-editable").each(function(){h(this).on("editing-start",function(){var c=h(this);c.data("rteinstance").editorKernel.addUIListener("disablesourceedit",function(){l(c)})})})});h(g).on("change",".cq-RichText-editable",function(c){l(h(this))})})(window,
document,Granite.$);
(function(c,g,h,l,m,p){function e(a){var b="";a.duplicate&&0<a.duplicate.length&&(b+='\x3cinput type\x3d"hidden" name\x3d"'+a.absolutePath+'@CopyFrom" value\x3d"'+a.duplicate+'" /\x3e');b+='\x3cinput type\x3d"hidden" name\x3d"'+B+'/sling:resourceType" value\x3d"'+A+'" /\x3e\x3cinput type\x3d"hidden" name\x3d"'+B+'/cq:policy" value\x3d"'+a.relativePath+'" /\x3e\x3cinput type\x3d"hidden" name\x3d"./jcr:primaryType" value\x3d"nt:unstructured" /\x3e\x3cinput type\x3d"hidden" name\x3d"./jcr:content/jcr:primaryType" value\x3d"nt:unstructured" /\x3e';V=
c(".cq-Policy-params");V.empty();V.append(b)}function f(a){var b="policy_"+(new Date).getTime();return c.extend({},{title:"",text:"",description:"",absolutePath:J+b,relativePath:Q+"/"+b,type:O},a)}function b(a){for(var b=y.items.getAll(),c=0,d=b.length;c<d;c++){var e=b[c];if(a===e.value)return e}}function a(a){if(a){if(a&&a.absolutePath)r=a;else{a=a&&0<a.length?b(a):y.items.first();if(a){var d=a instanceof jQuery?a:c(a);a=d.text();var f=d.val(),k=d.text();k===P&&(k="");d={title:a,text:k,nodeName:d.attr("data-policy-name")||
"",description:d.attr("data-policy-description")||"",absolutePath:f||"",relativePath:d.attr("data-policy-relative-path")||"",type:d.attr("data-policy-resource-type")||""}}r=d}r&&(F(r.absolutePath),d=r,T.value=d&&d.text?d.text:"",X.value=d&&d.description?d.description:"",e(r),(d=r)&&x.closest("form.cq-dialog").attr("action",d.absolutePath))}}function d(a){return a.text&&0<a.text.length?a.text:a.title&&0<a.title.length?a.title:P}function n(a){return{content:{textContent:d(a)},value:a.absolutePath}}
function k(a,b){a.dataset.description=b.description;a.dataset.policyName=b.nodeName;a.dataset.policyRelativePath=b.relativePath;a.dataset.policyResourceType=b.type}function q(a,d){if(!b(a.absolutePath)){var e=y.items.getAll(),f;c.isNumeric(d)&&d<y.items.length&&(f=e[d]);d=y.items.add(n(a),f);k(d,a);F(a.absolutePath)}}function F(a){Coral.commons.ready(y,function(){y.value=a})}function w(){var b=f();q(b);a(b);K()}function D(){var b=c.extend(!0,{},r),d=u+" "+b.text,e="policy_"+(new Date).getTime();b.text=
d;b.title=d;b.nodeName=e;b.duplicate=r.absolutePath;b.absolutePath=J+e;b.relativePath=Q+"/"+e;q(b);a(b)}function G(a){return(a=b(a.absolutePath))&&a.dataset.policyPersisted}function H(){G(r)?R():g.ui.helpers.prompt({title:Granite.I18n.get("Save Policy"),message:Granite.I18n.get("You must save the current policy before opening the design dialog."),actions:[{id:"CANCEL",text:Granite.I18n.get("Cancel","Label for Cancel button")},{id:"SAVE",text:Granite.I18n.get("Save","Label for persisting the policy before opening a classic design dialog"),
primary:!0}],callback:function(a){"SAVE"===a&&x.closest("form.cq-dialog").eq(0).on("submit",R).submit()}})}function R(){c.ajax({url:L,type:"get",data:{content:r.absolutePath,resourceType:O,policy:!0}}).done(function(a){c(m.body).append(a);var b=m.querySelector(".cq-compat-dialog");c(l).on("dialogwrapper-ready",function(){b.setAttribute("backdrop","modal");b.setAttribute("movable",!0)});var d=g.DialogFrame.closeDialog;g.DialogFrame.closeDialog=function(){g.DialogFrame.closeDialog=d}})}function K(){W.wait();
c.ajax({url:U+".html"+r.absolutePath,type:"get",data:{policyContentResourceType:Q,referrer:z,resourceType:O}}).done(function(a){var b=g.DialogFrame.currentFloatingDialog.remove();a=c(a).find(".js-cq-Policy-designWrapper").children();b.find(".js-cq-Policy-designWrapper").empty().append(a);c(m.body).append(b);g.DialogFrame.currentFloatingDialog=b;W.clearWait();b.trigger("cui-contentloaded");h.trigger("dialog-ready")})}function t(){r.text=r.title=T.value;r.description=X.value;var a=r;if(a){var c=b(a.absolutePath);
c&&a&&(c.content&&(c.content.textContent=d(a)),c.value=a.absolutePath,c.dataset&&k(c,a));e(a)}M()}function v(){var a=J.indexOf("/settings/wcm/policies/"),b=J.substr(0,a+23-1);a=J.substr(a+23,J.length);var d={};if(1>a.length)return c.Deferred().resolve();a.lastIndexOf("/")===a.length-1&&(a=a.substr(0,a.length-1));a=a.split("/");do d["./"+a.join("/")+"/jcr:primaryType"]="nt:unstructured",a.splice(a.length-1,1);while(0<a.length);return c.ajax({url:b,type:"post",data:d})}function M(){!T.value||1>T.value.length?
I.setAttribute("disabled",!0):I.removeAttribute("disabled")}function C(){W.wait();return c.ajax({type:"GET",url:Granite.HTTP.externalize("/mnt/overlay/cq/gui/components/authoring/dialog/policy/templates.html"+r.absolutePath),dataType:"html"}).done(function(a){c(".js-cq-Policy-templates").find(".js-cq-Policy-templates-list").replaceWith(a);W.clearWait()})}var P=Granite.I18n.get("New policy"),u=Granite.I18n.get("Copy of"),r,z,Q,B,A,N,E,S,O,J,U,L,x,y,I,Y,Z,T,X,V=c('\x3cspan class\x3d"cq-Policy-params"\x3e\x3cinput type\x3d"hidden" name\x3d"_charset_" value\x3d"utf-8" /\x3e\x3c/span\x3e'),
W=c(l).adaptTo("foundation-ui");h.on("foundation-contentloaded",function(){x=c(".js-Policy-dialog-content").eq(0);if(0<x.length){var b=c(".js-editor-Policy").eq(0);E=Granite.HTTP.internalize(b.closest("form.cq-dialog").attr("action"))||b.attr("data-policy-absolute-path");z=b.attr("data-policy-content-path");Q=b.attr("data-policy-content-resource-type");B=b.attr("data-policy-mapping-path");S=b.attr("data-policy-relative-path");N=b.attr("data-policy-name");O=b.attr("data-policy-resource-type");J=b.attr("data-policy-directory-path");
A=b.attr("data-policy-mapping-resource-type");U=b.attr("data-design-dialog-path");L=b.attr("data-design-dialog-classic-path");v().then(function(){Y=x.find(".js-Policy-create")[0];Z=x.find(".js-Policy-duplicate")[0];T=x.find(".js-Policy-detail-title")[0];X=x.find(".js-Policy-detail-description")[0];y=x.find(".js-Policy-dialog-select")[0];0===x.find(".cq-Policy-params").length&&x.prepend(V);Y.off(".policy").on("click.policy",w);Z.off(".policy").on("click.policy",D);x.off(".policy").on("blur keyup.policy",
".js-Policy-detail-title",t);x.off(".policy").on("blur keyup.policy",".js-Policy-detail-description",t);y.off(".policy").on("change.policy",function(b){b.target.selectedItem&&(a(b.target.selectedItem.value),K(),M())});E&&0<y.items.length?(a(E),r||(a(f({nodeName:N,absolutePath:E,relativePath:S,type:O})),q(r))):(a(f()),q(r));I=x.find(".js-cq-Policy-openClassicDesign")[0];L&&0<L.length&&I&&(I.className+=" is-visible",I.off(".policy").on("click.policy",H),M());C()})}})})(jQuery,Granite.author,jQuery(document),
this,document);
(function(c,g,h,l,m){function p(a,b,e,f,g){if(a&&0!==a.length&&f&&!(1>f.length)){var d=a.find("[data-name\x3d'"+b+"']").eq(0);if("-"!==f){var k=[];f=Array.isArray(f)?f:f.split(",");0<d.length&&(k=(k=d.val())?c.isArray(k)?k:-1===k.indexOf(",")?[k]:k.split(","):[]);if(g){if(f){k=k||[];0<f.length&&0<k.length&&-1<k.indexOf("-")&&(k=[]);g=0;for(var h=f.length;g<h;g++){for(var m=!1,n=f[g],q=0,l=k.length;q<l;q++)if(n===k[q]){m=!0;break}m||k.push(n)}}}else if(f)for(k=k||[],g=0,h=f.length;g<h;g++){m=-1;n=
f[g];q=0;for(l=k.length;q<l;q++)if(n===k[q]){m=q;break}-1<m&&k.splice(m,1)}f="-";0<k.length&&(f=k.join(","))}0<d.length?d.val(f):a.append('\x3cinput type\x3d"hidden" data-name\x3d"'+b+'" name\x3d"'+e+'" value\x3d"'+f+'"/\x3e')}}function e(a,b){!a||0===a.length||!b||1>b.length||a.find("input[type\x3d'hidden'][data-name\x3d"+b+"]").remove()}function f(a,b){return!b||1>b.length?"./plugins/"+a+"/features":"./"+(b.data("pluginRootName")||"plugins")+"/"+a+"/features"}function b(a){var b=c(a).closest("coral-checkbox"),
g=b.closest(".js-cq-IPEPlugin-group"),k=b.data("name"),h=b.data("features");if(k){var m=g.closest("form").find(".js-cq-IPEPlugin-hiddenInput").eq(0);a=a.querySelector("input[type\x3dcheckbox]").checked;b.is(".js-cq-IPEPlugin-feature")?!m||!k||1>k.length||!h||1>h.length||(b=f(k,g),h&&(e(m,name),p(m,k,b,h,a))):(b=f(k,g),e(m,k),h&&0<h.length&&p(m,k,b,a?h:"-",a));k=g.data("name");h=g.find(".js-cq-IPEPlugin input[type\x3dcheckbox]:checked").length;k&&0<k.length&&p(m,k,f(k,g),g.data("features"),0<h)}}h.on("dialog-loaded",
function(a){h.off(".IPEPlugin");h.find(".js-cq-IPEPlugin-group").each(function(){var a=c(this).closest("form");1>a.find(".js-cq-IPEPlugin-hiddenInput").length&&a.append('\x3cspan class\x3d"js-cq-IPEPlugin-hiddenInput"\x3e')});h.on("click.IPEPlugin",".js-cq-IPEPlugin",function(a){b(a.currentTarget)});c(".cq-Dialog .js-cq-IPEPlugin").each(function(){b(this)})})})(jQuery,Granite.author,jQuery(document),this);
(function(c,g,h,l,m,p){var e=["imageMap","imageCrop","imageRotate"],f=function(b){var a=this;a._element=b.element;a._$element=c(b.element);var d=a._$element.find("input[type\x3dfile]").attr("name");d=d.substr(0,d.lastIndexOf("/"))||"";""!==d&&(d+="/");a.path=d;null==b.allowUpload?a._allowUpload=a._element.hasAttribute("data-cq-fileupload-allowupload"):("string"===typeof b.allowUpload&&(b.allowUpload="true"==b.allowUpload),a._allowUpload=b.allowUpload);a._element.action||(a._element.action=a._$element.closest("form.cq-dialog").attr("action"));
a._element.parameters=[];a._inputs=[];a._$element.find("input[type\x3d'hidden'][data-cq-fileupload-parameter]").each(function(){var b=this.getAttribute("data-cq-fileupload-parameter");a._inputs[b]=this});a._removeDuplicateHiddenInputs();a._bindEvents();a._hasImageMimeType()&&a._addImageEditorFields()};f.prototype._appendHiddenInput=function(b,a){var d=this._$element.closest("form").find("input[name\x3d'"+b+"']");if(0===d.length)d=c("\x3cinput type\x3d'hidden'/\x3e").attr("name",b),a.hasOwnProperty("class")&&
d.attr("class",a["class"]),this._element.appendChild(d[0]);else if(0===d.closest(this._element).length)return;this._updateHiddenInput(d[0],a);return d[0]};f.prototype._updateHiddenInput=function(b,a){b!==p&&a!==p&&(a.value!==p&&b.setAttribute("value",a.value),a.disabled?c(b).prop("disabled",!0):!1===a.disabled&&c(b).removeProp("disabled"))};f.prototype._removeDuplicateHiddenInputs=function(){var b=this;b._$element.find("input[type\x3d'hidden']").each(function(){1<b._$element.closest("form").find("input[name\x3d'"+
this.getAttribute("name")+"']").length&&this.parentNode.removeChild(this)})};f.prototype._addParamInputs=function(b){var a;if("string"===typeof b)try{b=JSON.parse(b)}catch(n){}if("object"===typeof b)for(a in b)if(b.hasOwnProperty(a)){var c=this._appendHiddenInput(a,{value:b[a],disabled:!1});c&&c.setAttribute("data-cq-fileupload-parameter","additional")}};f.prototype._removeAdditionalSlingParamHiddenInputs=function(){this._$element.find("[data-cq-fileupload-parameter\x3d'additional']").remove()};f.prototype._bindEvents=
function(){var b=this;b._$element.find("[coral-fileupload-clear]").on("click",function(a){b._updateHiddenInput(b._inputs.filename,{value:"",disabled:!1});b._updateHiddenInput(b._inputs.filereference,{value:"",disabled:!1});b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");b._updateHiddenInput(b._inputs.filedelete,{value:"true",disabled:!1});b._updateHiddenInput(b._inputs.filemovefrom,{value:"",disabled:!0});b._removeAdditionalSlingParamHiddenInputs();b._element.classList.remove("is-filled");
b._$element.find("[data-cq-fileupload-thumbnail-img]").empty()});b._$element.on("assetselected",function(a){!b._element.disabled&&b._isMimeTypeAllowed(a.mimetype)&&(b._removeAdditionalSlingParamHiddenInputs(),b._updateHiddenInput(b._inputs.filereference,{value:a.path,disabled:!1}),b._updateHiddenInput(b._inputs.filedelete,{value:"false"}),b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true"),b._updateHiddenInput(b._inputs.filemovefrom,{value:"false"}),b._addParamInputs(a.param),
b._element.classList.add("is-filled"),b._$element.find("[data-cq-fileupload-thumbnail-img]").empty().append(a.thumbnail),b._$element.trigger("change"),b._$element.find(".cq-FileUpload-edit").data("cqFileuploadFilereference",a.path).prop("disabled",!1))});b._allowUpload&&(b._element.on("coral-fileupload:fileadded",function(a){b._removeAdditionalSlingParamHiddenInputs();if(b._hasImageMimeType()){var c=b._$element.closest("form");c&&(c=c.attr("action").replace("_jcr_content","jcr:content"),g.author&&
g.author.editables&&(c=g.author.editables.find(c),0<c.length&&"function"===typeof c[0].getDropTarget&&(c=c[0].getDropTarget("image"))&&b._addParamInputs(c.params)))}c=b._$element.find("input[type\x3dfile]");a=a.detail.item.file.name;var e=c.attr("name"),f=b._element.getAttribute("data-cq-fileupload-temporaryfilename");c.attr("name",f);b._element.upload(a);c.attr("name",e);b._$element.trigger("change");b._$element.find(".cq-FileUpload-edit").prop("disabled",!0)}),b._element.on("coral-fileupload:load",
function(a){var d=b._$element.find("[data-cq-fileupload-thumbnail-img]"),e=a.detail.item._originalFile;d.empty();-1!==e.type.indexOf("image")?function(a,b){b.onload=function(b){a.append(c("\x3cimg/\x3e").attr("src",b.target.result))};b.readAsDataURL(e)}(d,new FileReader):(a=c("\x3cp\x3e"+e.name+"\x3c/p\x3e"),d.append(a));d=b._element.getAttribute("data-cq-fileupload-temporaryfilepath");b._updateHiddenInput(b._inputs.filename,{value:e.name,disabled:!1});b._updateHiddenInput(b._inputs.filereference,
{value:"",disabled:!1});b._updateHiddenInput(b._inputs.filedelete,{disabled:!0});b._updateHiddenInput(b._inputs.filemovefrom,{value:d,disabled:!1});b._$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");b._temporaryFileUploaded=!0;b._element.classList.add("is-filled");b._element.classList.remove("is-active")}),h.off("dialog-closed.fileupload").one("dialog-closed.fileupload",function(a){b._temporaryFileUploaded&&b._deleteTemporaryFileUpload()}),h.off("dragover.fileupload").on("dragover.fileupload",
function(a){a.originalEvent.dataTransfer&&a.originalEvent.dataTransfer.files&&b._element.classList.add("is-active")}).off("dragleave.fileupload").on("dragleave.fileupload",function(){b._element.classList.remove("is-active")}))};f.prototype._deleteTemporaryFileUpload=function(){var b={};b[this._element.getAttribute("data-cq-fileupload-temporaryfiledelete")]=!0;c.post(this._element.action,b)};f.prototype._isMimeTypeAllowed=function(b){var a=!1,c=this._element.accept.split(",");if(""==c)return!0;c.some(function(c){if(c===
b||"*"===c||(new RegExp(c)).test(b))return a=!0});return a};f.prototype._hasImageMimeType=function(){for(var b=this._element.accept.split(","),a=!1,c=0;c<b.length&&!(a=b[c].match("image/*"));c++);return a};f.prototype._addImageEditorFields=function(){var b=this;e.forEach(function(a){b._appendHiddenInput(b.path+a+"@Delete",{"class":"cq-ImageEditor-param",disabled:!0,value:""})})};h.on("foundation-contentloaded",function(b){c(b.target).find("coral-fileupload.cq-FileUpload").each(function(){Coral.commons.ready(this,
function(a){a:{if(g.author){var b=c(a).closest("form.cq-dialog");if(!(1>b.length)&&(b=b.attr("action").replace("_jcr_content","jcr:content"),(b=Granite.HTTP.internalize(b))&&!(1>b.length)&&(b=g.author.editables.find(b))&&0<b.length)){b=g.author.editableHelper.getStyleProperty(b[0],"allowUpload");break a}}b=void 0}new f({element:a,allowUpload:b})})})});h.off("click.fileupload",".cq-FileUpload-edit").on("click.fileupload",".cq-FileUpload-edit",function(b){var a=c(b.currentTarget);b=a.data("cqFileuploadFilereference");
a=a.data("cqFileuploadViewinadminuri");b=Granite.URITemplate.expand(a,{item:b});b=Granite.HTTP.externalize(b);"single"===c("meta[name\x3d'user.preferences.winmode']").attr("content")?m.location.href=b:m.open(b)})})(Granite.$,Granite,jQuery(document),document,this);
(function(c,g,h,l,m,p){c=c(m).adaptTo("foundation-registry");c.register("foundation.adapters",{type:"foundation-field",selector:"coral-fileupload.cq-FileUpload",adapter:function(c){return{isRequired:function(){return c.dataset.cqFileuploadRequired!==p},setRequired:function(e){e?c.dataset.cqFileuploadRequired="":delete c.dataset.cqFileuploadRequired}}}});c.register("foundation.validation.validator",{selector:"coral-fileupload.cq-FileUpload[data-cq-fileupload-required]",validate:function(c){if(!c.uploadQueue.length&&
!c.classList.contains("is-filled"))return Granite.I18n.get("Please fill out this field.")}})})(Granite.$,Granite,jQuery(document),document,this);
(function(c,g,h,l,m,p){var e=["imageMap","imageCrop","imageRotate"],f="\x3cspan class\x3d'cq-FileUpload-clear coral-Button coral-Button--quiet'\x3e"+Granite.I18n.get("Clear")+"\x3c/span\x3e",b="\x3cdiv class\x3d'cq-FileUpload-thumbnail'\x3e\x3cdiv class\x3d'cq-FileUpload-thumbnail-img'\x3e\x3c/div\x3e\x3cdiv class\x3d'cq-FileUpload-thumbnail-dropHere'\x3e\x3ci class\x3d'coral-Icon coral-Icon--image cq-FileUpload-icon'\x3e\x3c/i\x3e\x3cspan class\x3d'cq-FileUpload-label'\x3e"+Granite.I18n.get("Drop an asset here or \x3ca class\x3d'coral-Link {0}'\x3ebrowse\x3c/a\x3e for a file to upload.",
"cq-FileUpload-browse","0 replace by class name, not visible string")+"\x3c/div\x3e\x3c/div\x3e";g.FileUploadField=function(a,b,c){this.widget=a;this.resourceURL=b;a=this.widget.$inputContainer.find("input[type\x3d'file']");null==c?this.widget.options.allowUpload="undefined"===typeof a.data("allowupload")||!!a.data("allowupload"):("string"===typeof c&&(c="true"==c),this.widget.options.allowUpload=c);this._computeFieldNames();this._createMissingElements();this._bindEvents();this.widget.$element.addClass("cq-FileUpload");
this.widget.$element.addClass("cq-droptarget");this.widget.$inputContainer.hide();this.widget.options.uploadUrl=b};g.FileUploadField.prototype._appendThumbnail=function(a,b){var d="?:ck\x3d"+(new Date).getTime();a=c("\x3cimg/\x3e",{alt:a,"class":"cq-dd-image",src:a+d});b.append(a);this.widget.$element.addClass("is-filled")};g.FileUploadField.prototype._createThumbnailFromRendition=function(a,b,e){e||(e="cq5dam.web");var d=this,f=a+"/jcr:content/renditions.1.json";c.getJSON(f).then(function(c){var f=
null,k;for(k in c)if(c.hasOwnProperty(k)&&0===k.indexOf(e)){f=a+"/jcr:content/renditions/"+k;break}d._appendThumbnail(f?f:a,b)},function(){b.append(c("\x3cp\x3eExpecting DAM asset to have renditions, but request to "+f+" failed\x3c/p\x3e"))})};g.FileUploadField.prototype._refreshThumbnail=function(){var a=this,b=a.widget.$element.find(".cq-FileUpload-thumbnail-img"),e;b.empty();c.ajax({url:a.resourceURL+".json",cache:!1}).done(function(d){var f=a.fieldNames.fileName.substr(a.fieldNames.fileName.lastIndexOf("/")+
1),k=a.fieldNames.fileReference.substr(a.fieldNames.fileReference.lastIndexOf("/")+1);f=d[f];if((d=d[k])||f)a._hasImageMimeType()?d?a._createThumbnailFromRendition(d,b):a._appendThumbnail(a.resourceURL+".img.png",b):a._hasVideoMimeType()&&d?a._createThumbnailFromRendition(d,b,"cq5dam.thumbnail.3"):(e=c("\x3cp\x3e"+(d||f)+"\x3c/p\x3e"),b.append(e),a.widget.$element.addClass("is-filled"))})};g.FileUploadField.prototype._addElements=function(){var a=c(b);this.widget.options.allowUpload||a.find(".cq-FileUpload-label").text(Granite.I18n.get("Drop an asset here."));
this.widget.$element.append(a);this.widget.$element.find(".cq-FileUpload-thumbnail-img").after(c(f));a.find(".cq-FileUpload-browse").append(this.widget.$inputContainer.find('input[type\x3d"file"]'))};g.FileUploadField.prototype._computeFieldNames=function(){var a=this.widget.$element.find("input[type\x3dfile]"),b=a.attr("name")||"",c=b.substr(0,b.lastIndexOf("/"))||"",e=c.match(/^\.(\/.+)$/);".sftmp"===b.substr(-6)&&(b=b.substr(0,b.length-6));""!==c&&(c+="/");this.path=c;this.fieldNames={fileName:a.data("fileNameParameter")||
c+"fileName",fileReference:a.data("filereferenceparameter")||c+"fileReference",lastModified:c+"jcr:lastModified",lastModifiedBy:c+"jcr:lastModifiedBy",fileDelete:b+"@Delete",fileMoveFrom:b+"@MoveFrom",tempFileName:b+".sftmp",tempFileDelete:b+".sftmp@Delete"};e?(this._tempFilePath=this.resourceURL+this.fieldNames.tempFileName.substr(1),this.resourceURL+=e[1]):this._tempFilePath=this.resourceURL+"/"+this.fieldNames.tempFileName;this._tempFilePath=this._tempFilePath.replace(new RegExp("^"+g.HTTP.getContextPath()),
"").replace("_jcr_content","jcr:content")};g.FileUploadField.prototype._addParamFields=function(a){var b;if("string"===typeof a)try{a=JSON.parse(a)}catch(n){}if("object"===typeof a)for(b in a)a.hasOwnProperty(b)&&this._appendHiddenField(b,"cq-FileUpload-param",a[b])};g.FileUploadField.prototype._addImageEditorFields=function(){var a=this;e.forEach(function(b){a._appendHiddenField(a.path+b+"@Delete","cq-ImageEditor-param","",!0)})};g.FileUploadField.prototype._addHiddenFields=function(){this._appendHiddenField(this.fieldNames.fileName,
"cq-FileUpload-filename",!1,!0);this._appendHiddenField(this.fieldNames.fileReference,"cq-FileUpload-filereference",!1,!0);this._appendHiddenField(this.fieldNames.fileDelete,"cq-FileUpload-filedelete",!1,!0);this._appendHiddenField(this.fieldNames.fileMoveFrom,"cq-FileUpload-filemovefrom",this._tempFilePath,!0);this._appendHiddenField(this.fieldNames.lastModified);this._appendHiddenField(this.fieldNames.lastModifiedBy)};g.FileUploadField.prototype._removeAdditionalSlingParamHiddenFields=function(){this.widget.$element.find("inputcq-FileUpload-param").remove()};
g.FileUploadField.prototype._appendHiddenField=function(a,b,e,f){var d=this.widget.$element.closest("form").find('input[name\x3d"'+a+'"]');if(0===d.length)d=c("\x3cinput type\x3d'hidden'/\x3e").attr("name",a),this.widget.$element.append(d);else if(0===d.closest(this.widget.$element).length)return;if(b!==p)for(c.isArray(b)||(b=[b]),a=0;a<b.length;a++)d.addClass(b[a]);e!==p&&d.attr("value",e);f!==p&&d.attr("disabled",!0)};g.FileUploadField.prototype._createMissingElements=function(){this._addElements();
this._addHiddenFields();this._refreshThumbnail();this._hasImageMimeType()&&this._addImageEditorFields()};g.FileUploadField.prototype._bindEvents=function(){var a=this,b=null,e=!1;a.widget.$element.find(".cq-FileUpload-browse").on("click tap",function(){a.widget.$element.hasClass("is-disabled")||a.widget.$inputContainer.find("input[type\x3d'file']").trigger("click")});a.widget.$element.find(".cq-FileUpload-clear").on("click tap",function(b){a.widget.$element.find(".cq-FileUpload-filedelete").removeAttr("disabled").val("true");
a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val("");a.widget.$element.find(".cq-FileUpload-filename").removeAttr("disabled").val("");a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("true");a._removeAdditionalSlingParamHiddenFields();a.widget.$element.find(".cq-FileUpload-filemovefrom").attr("disabled",!0);a.widget.$element.removeClass("is-filled");a.widget.$element.find(".cq-FileUpload-thumbnail-img").empty();a.widget.$element.find('input[type\x3d"file"]').val("");
a.widget.$element.trigger("change")});a.widget.$element.on("assetselected",function(b){var c=b.path,d=b.param,e=b.thumbnail;b=b.mimetype;!a.widget.$element.hasClass("is-disabled")&&a._isMimeTypeAllowed(b)&&(a._removeAdditionalSlingParamHiddenFields(),a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val(c),a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val(""),a.widget.$element.find(".cq-FileUpload-filedelete").val("false"),a.widget.$element.find(".cq-FileUpload-filemovefrom").val("false"),
a.widget.$element.find(".cq-FileUpload-thumbnail-img").empty().append(e),a._addParamFields(d),a.widget.$element.addClass("is-filled"),a.widget.$element.trigger("change"))});a.widget.$element.on("fileselected",function(c){var d;if(!a.widget.$element.hasClass("is-disabled")&&a.widget.options.allowUpload){a._removeAdditionalSlingParamHiddenFields();a._hasImageMimeType()&&(d=a.widget.$element.closest("form"))&&(d=d.attr("action").replace("_jcr_content","jcr:content"),g.author&&g.author.editables&&(d=
g.author.editables.find(d),0<d.length&&"function"===typeof d[0].getDropTarget&&(d=d[0].getDropTarget("image"))))&&(d=d.params,a._addParamFields(d));delete a.widget.fileNameElement;delete a.widget.options.fileNameParameter;if(a.widget.options.useHTML5)c.item.fileName=a.fieldNames.tempFileName,a.widget.uploadFile(c.item);else{d=a.widget.$element.find("input[type\x3dfile]");var e=d.attr("name");b=c.item.fileName;d.attr("name",a.fieldNames.tempFileName);a.widget.uploadFile(c.item);d.attr("name",e)}a.widget.$element.find(".cq-ImageEditor-param").removeAttr("disabled").val("");
a.widget.$element.trigger("change")}});a.widget.$element.on("dropzonedragover",function(b){a.widget.$element.addClass("is-hovered")});a.widget.$element.on("dropzonedragleave",function(b){a.widget.$element.removeClass("is-hovered")});a.widget.$element.on("dropzonedrop",function(b){a.widget.$element.removeClass("is-hovered")});c(m).on("dragover",function(b){b.originalEvent.dataTransfer&&b.originalEvent.dataTransfer.files&&a.widget.$element.addClass("is-active")}).on("dragleave",function(){a.widget.$element.removeClass("is-active")});
Granite.author&&!a.widget.options.useHTML5&&(a.widget.$element.on("drop",function(b){a.widget.$element.trigger("dropzonedrop")}),a.widget.$element.on("dragover",function(b){b.stopPropagation();b.preventDefault();a.widget.$element.trigger("dropzonedragover")}),a.widget.$element.on("dragleave",function(b){b.stopPropagation();b.preventDefault();a.widget.$element.trigger("dropzonedragleave")}));a.widget.$element.on("fileuploadload",function(d){var e=c(d.content).find("#Status").text();var f=d.item||{};
f.file=f.file||{};f.file.type=f.file.type||"";f.file.name=f.file.name||b;b=null;a.widget._internalOnUploadLoad(d,f,e,d.content)});a.widget.$element.on("fileuploadsuccess",function(b){var d=a.widget.$element.find(".cq-FileUpload-thumbnail-img"),f=b.item.file;d.empty();-1!==f.type.indexOf("image")?(a.widget.$element.addClass("is-filled"),function(a,b){b.onload=function(b){a.append(c("\x3cimg/\x3e").attr("src",b.target.result))};b.readAsDataURL(f)}(d,new FileReader)):(b=c("\x3cp\x3e"+f.name+"\x3c/p\x3e"),
a.widget.$element.addClass("is-filled"),d.append(b));a.widget.$element.find(".cq-FileUpload-filereference").removeAttr("disabled").val("");a.widget.$element.find(".cq-FileUpload-filedelete").attr("disabled","true");a.widget.$element.find(".cq-FileUpload-filemovefrom").removeAttr("disabled").val(a._tempFilePath);a.widget.$element.find(".cq-FileUpload-filename").removeAttr("disabled").prop("value",f.name);e=!0});h.one("dialog-closed",function(b){e&&a._deleteTempUpload()})};g.FileUploadField.prototype._deleteTempUpload=
function(){var a={};a[this.fieldNames.tempFileDelete]=!0;c.post(this.widget.options.uploadUrl,a)};g.FileUploadField.prototype._isMimeTypeAllowed=function(a){var b=!1;this.widget.options.mimeTypes.some(function(c){if("*"===c||(new RegExp(c)).test(a))return b=!0});return b};g.FileUploadField.prototype._hasImageMimeType=function(){return-1!==this.widget.options.mimeTypes.indexOf("image")};g.FileUploadField.prototype._hasVideoMimeType=function(){return-1!==this.widget.options.mimeTypes.indexOf("video")};
h.on("cui-contentloaded",function(a){c(a.target).find(".coral-FileUpload:not('.is-initialized')").each(function(){var a=c(this),b=a.data("fileUpload"),e=a.parents("form.cq-dialog").attr("action");a.addClass("is-initialized");if(b&&!a.parents(".cq-wcm-pagethumbnail").length){a=g.FileUploadField;var f=c(this).closest("form.cq-dialog");1>f.length?f=void 0:(f=f.attr("action").replace("_jcr_content","jcr:content"),f=Granite.HTTP.internalize(f),f=!f||1>f.length?void 0:(f=g.author.editables.find(f))&&0<
f.length?g.author.editableHelper.getStyleProperty(f[0],"allowUpload"):void 0);new a(b,e,f)}})})})(jQuery,Granite,jQuery(document),this,document);
(function(c,g){function h(c){c.each(function(c,e){g(e).is("coral-select")?Coral.commons.ready(e,function(c){l(c,e);c.on("change",function(){l(c,e)})}):(c=g(e).data("select"))&&l(c,e)})}function l(c,h){h=g(h).data("cqDialogDropdownShowhideTarget");var e=g(h);if(h){var f;"undefined"!==typeof c.value?f=c.value:"function"===typeof c.getValue&&(f=c.getValue());e.not(".hide").addClass("hide");e.filter("[data-showhidetargetvalue\x3d'"+f+"']").removeClass("hide")}}g(c).on("foundation-contentloaded",function(c){h(g(".cq-dialog-dropdown-showhide",
c.target))});g(c).on("selected",".cq-dialog-dropdown-showhide",function(c){h(g(this))})})(document,Granite.$);$(document).on("foundation-contentloaded",function(c){var g=$(".cq-dialog .cq-ComponentStyles");g.find("coral-select").on("change",function(c){var h="";g.find("coral-select").each(function(){var c=this.value;c&&(h.length&&(h+=" "),h+=c)});g.find("input[type\x3dhidden]").first().val(h)})});
(function(c,g,h,l){Granite.DialogUtils={unifySpacing:function(c){if(c){var g=c.classList.contains("cq-dialog-floating"),e=c.querySelector("coral-dialog-content"),f=e.querySelector(".cq-dialog-content"),b=c.querySelector(".coral-TabPanel"),a=c.querySelectorAll(".coral-TabPanel-content"),d=c.querySelectorAll(".coral-FixedColumn");if("coral-tabview"!==f.tagName.toLowerCase()&&!f.querySelector("coral-tabview")){g?e.classList.add("u-coral-noPadding","u-coral-noMargin"):(e.classList.remove("u-coral-noPadding"),
e.classList.add("u-coral-noMargin"),c.style.overflow="auto");if(b)for(b.classList.add("u-coral-noPadding","u-coral-noMargin"),c=0;c<a.length;c++)a[c].classList.add("u-coral-noPadding","u-coral-noMargin");if(0<d.length)for(c=0;c<d.length;c++)d[c].classList.add("u-coral-noPadding","u-coral-noMargin"),d[c].querySelector(".coral-FixedColumn-column").classList.add("u-coral-padding","u-coral-noMargin");else if(b)for(c=0;c<a.length;c++)a[c].classList.remove("u-coral-noPadding"),a[c].classList.add("u-coral-padding");
else 1===f.children.length&&f.children[0].classList.add("u-coral-padding")}}}}})(window,document,Granite.$,Granite.author);
(function(c,g,h,l){function m(f){f.data("cqDialogReturntoreferral")?c.location=g.referrer:f.closest(".cq-dialog-page").length?c.location=f.data("cqDialogPageeditor"):f.remove();e.trigger("dialog-closed")}function p(c){c.trigger("dialog-beforeclose");c=c.find("form").eq(0);c.trigger("dialog-beforeclose");m(c)}h(c).adaptTo("foundation-ui");var e=h(g);e.on("click",".cq-dialog-cancel",function(c){c.preventDefault();c=h(this).closest(".cq-Dialog");p(c)});e.on("coral-overlay:beforeclose",".cq-Dialog",function(c){h(c.target).hasClass("cq-Dialog")&&
p(h(this))});e.on("click",".cq-dialog-layouttoggle",function(c){var b=this.closest("coral-dialog");Granite.DialogUtils.unifySpacing(b);c.preventDefault()});e.on("click",".cq-dialog-help",function(e){e.preventDefault();e=h(this);c.open(e.data("href"),"_blank")});e.on("foundation-form-submitted",".cq-Dialog",function(c,b,a){!0===b?(c=h(this),e.trigger("dialog-success"),c.trigger("dialog-beforeclose"),c.find("form").eq(0).trigger("dialog-beforeclose"),m(c.find("form").eq(0))):e.trigger("dialog-fail",
a)});e.on("foundation-contentloaded",function(c){c=h(c.target).find("#cq-sites-properties-form, .cq-dialog");if(c.length){var b=c.find("input[name\x3d'./sling:resourceType']").val();Granite.DialogUtils.unifySpacing(c.parents("coral-dialog").get(0));e.trigger(h.Event("dialog-loaded",{dialog:c,resourceType:b}))}});h("body").on("submit",".cq-Dialog",function(c){h(this).find("input, textarea").blur()})})(window,document,Granite.$,Granite.author);
(function(c,g){var h=/^([0-9]+(\.[0-9]+)?(px|em|ex|%|in|cm|mm|pt|pc))$/;c(window).adaptTo("foundation-registry").register("foundation.validation.validator",{selector:'[data-validation\x3d"cq.cssunit"]',validate:function(c){if(!c.value&&!h.test(c.value))return g.I18n.get("Must be a valid CSS length. ex: 10px or 2.3em")}});var l=/^[a-zA-Z0-9_\\.\\/:\\-]+$/;c(window).adaptTo("foundation-registry").register("foundation.validation.validator",{selector:'[data-validation\x3d"cq.formfieldname"]',validate:function(c){if(!c.value&&
!l.test(c.value))return g.I18n.get("Element name should only contain characters, numbers or _./:-")}})})(Granite.$,Granite);
(function(c,g,h,l,m,p){h.on("change",".js-cq-AllowedComponents-component coral-checkbox",function(){var e=c(this).closest(".js-cq-AllowedComponents-componentGroup"),f=e.find(".js-cq-AllowedComponents-groupCheckbox"),b=e.find(".js-cq-AllowedComponents-group coral-tag"),a=e.find(".js-cq-AllowedComponents-component coral-checkbox");e=a.length;a=a.filter(function(){return this.checked}).length;f.prop("indeterminate",0<a&&a<e);b.get(0).label.textContent=a;b.attr("hidden",0<a?null:"")});h.on("change",".js-cq-AllowedComponents-groupCheckbox",
function(e){var f=c(this).closest(".js-cq-AllowedComponents-componentGroup");e=f.find(".js-cq-AllowedComponents-group coral-tag");f=f.find(".js-cq-AllowedComponents-component coral-checkbox");f.prop("checked",this.checked).prop("disabled",this.checked);e.get(0).label.textContent=f.length;e.attr("hidden",this.checked?null:"")})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,g,h,l,m,p){function e(){k=[];n={};q=p;q||(q=a.find(".js-cq-AllowedComponents-componentTitle"));var b=q;for(var c=0,d=b.length;c<d;c++){var e=[],f=b.eq(c),g=f.closest(".js-cq-AllowedComponents-component"),h=g.closest(".js-cq-AllowedComponents-componentGroup"),l=h.find(".js-cq-AllowedComponents-groupTitle").text(),m=g.data("resourceType");e.push(f.text().trim().toLowerCase());e.push(l.trim().toLowerCase());m&&0<m.length&&e.push(m);k.push({labels:e.slice(),element:g.get(0)});if(n[l])for(f=
n[l],g=0,h=e.length;g<h;g++)0>f.labels.indexOf(e[g])&&f.labels.push(e[g]);else n[l]={labels:e,element:h.get(0)}}}function f(a){for(var b in a)a.hasOwnProperty(b)&&a[b].element.removeAttribute("hidden")}function b(a,b){if(a&&!(1>a.length))for(var c in b)if(b.hasOwnProperty(c)){for(var d=b[c],e=d.labels,f=!1,g=0,h=e.length;g<h;g++)if(-1<e[g].indexOf(a.toLowerCase())){f=!0;break}f?d.element.removeAttribute("hidden"):d.element.setAttribute("hidden","")}}var a,d,n,k,q;h.on("foundation-contentloaded",function(){a=
c(".js-cq-AllowedComponents").eq(0);d=c(".js-cq-AllowedComponents-filter").eq(0);0<d.length&&0<a.length&&(e(),d.on("input coral-search:clear",function(){var a=d.val();a||0<a.length?!a||1>a.length||(b(a,n),b(a,k)):(f(k),f(n))}))})})(jQuery,Granite.author,jQuery(document),this,document);
(function(c,g,h,l,m){function p(a){return'\x3cspan class\x3d"js-cq-AssetToComponentMapper-mappingHiddenInputs"\x3e\x3c/span\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Component")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/resourceType" class\x3d"js-cq-AssetToComponentMapper-resourceType coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose a component")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3ccoral-alert variant\x3d"warning" class\x3d"cq-AssetToComponentMapper-resourceType--notAllowed"\x3e\x3ccoral-alert-content\x3e'+
Granite.I18n.get("Component not allowed by the container")+'\x3c/coral-alert-content\x3e\x3c/coral-alert\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper" hidden\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Drop target")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/droptarget" class\x3d"js-cq-AssetToComponentMapper-dropTarget coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose a drop target")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper" hidden\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+
Granite.I18n.get("Asset Group")+'\x3c/label\x3e\x3ccoral-select name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/assetGroup" class\x3d"js-cq-AssetToComponentMapper-assetGroup coral-Form-field" placeholder\x3d"'+Granite.I18n.get("Choose an asset group")+'" required\x3e\x3c/coral-select\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3clabel class\x3d"coral-Form-fieldlabel"\x3e'+Granite.I18n.get("Mime types")+'\x3c/label\x3e\x3ccoral-multifield class\x3d"js-cq-AssetToComponentMapper-mimeTypes coral-Form-field" disabled\x3e\x3cbutton coral-multifield-add type\x3d"button" is\x3d"coral-button" class\x3d"js-cq-AssetToComponentMapper-addMimeType" disabled\x3e'+
Granite.I18n.get("Add type")+'\x3c/button\x3e\x3ctemplate coral-multifield-template\x3e\x3cinput is\x3d"coral-textfield" type\x3d"text" name\x3d"./cq:authoring/assetToComponentMapping/'+a+'/assetMimetype"\x3e\x3c/template\x3e\x3c/coral-multifield\x3e\x3c/div\x3e\x3cdiv class\x3d"coral-Form-fieldwrapper"\x3e\x3cbutton is\x3d"coral-button" variant\x3d"warning" class\x3d"js-cq-AssetToComponentMapper-deleteMapping coral-Form-field"\x3e'+Granite.I18n.get("Delete")+"\x3c/button\x3e\x3c/div\x3e"}function e(a){Coral.commons.ready(a,
function(b){if(b.selectedItem)var c=b.selectedItem.value;b.items.clear();var d=a.closest(".js-cq-AssetToComponentMapper-mapping");d.className=d.className.replace("cq-AssetToComponentMapper-mapping--notAllowed","");var e=c,f=[],g;for(g in H){if(H.hasOwnProperty(g))var h=H[g];h&&f.push({content:{textContent:h.title+" - "+h.group},value:h.resourceType,selected:e&&e===h.resourceType})}c&&!H[c]&&((c=G[c])&&f.unshift({content:{textContent:c.title+" - "+c.group},value:c.resourceType,selected:!0}),d.classList.add("cq-AssetToComponentMapper-mapping--notAllowed"));
d=0;for(c=f.length;d<c;d++)b.items.add(f[d])})}function f(){var a=w.items.add({label:{innerHTML:Granite.I18n.get("New Asset Mapping")},selected:!0}),b="mapping_"+ +new Date;a.dataset.name=b;a.classList.add("js-cq-AssetToComponentMapper-mapping");b=c.parseHTML(p(b));for(var d=0,f=b.length;d<f;d++)a.content.appendChild(b[d]);a=a.content.querySelector(".js-cq-AssetToComponentMapper-resourceType");e(a)}function b(a){if(a=a.target.closest(".js-cq-AssetToComponentMapper-mapping")){var b=a.dataset.name,
c=document.createElement("input");c.type="hidden";c.name="./cq:authoring/assetToComponentMapping/"+b+"@Delete";c.value="";w.appendChild(c);w.items.remove(a)}}function a(a,b){if(b.groups){var c=!0;b.groups.forEach(function(b){a.items.add({content:{textContent:b},value:b,selected:c});c=!1});a.closest(".coral-Form-fieldwrapper").hidden=2>b.groups.length}}function d(b,c){if(b&&c&&c.dropTargets){var d=b.querySelector(".js-cq-AssetToComponentMapper-dropTarget"),e=b.querySelector(".js-cq-AssetToComponentMapper-assetGroup"),
f=b.querySelector(".js-cq-AssetToComponentMapper-mimeTypes");d.items.clear();e.items.clear();f.items.clear();var g=!0;d.closest(".coral-Form-fieldwrapper").hidden=2>c.dropTargets.length;c.dropTargets.forEach(function(f){d.items.add({content:{textContent:f.name},value:f.name,selected:g});g&&(a(e,f),k(b,c));g=!1})}}function n(a){var b=a.target,c=b.closest(".js-cq-AssetToComponentMapper-mapping"),e=c.querySelector(".js-cq-AssetToComponentMapper-dropTarget");(b=G[b.value])&&c&&d(c,b);c&&b&&e&&k(c,b);
a=a.target.closest(".js-cq-AssetToComponentMapper-mapping");c=a.querySelector(".js-cq-AssetToComponentMapper-resourceType");c=G[c.value];a.label.innerHTML=c.title+" - "+c.group}function k(a,b){if(a&&b&&b.dropTargets){var c=a.querySelector(".js-cq-AssetToComponentMapper-dropTarget"),d=a.querySelector(".js-cq-AssetToComponentMapper-mimeTypes"),e=a.querySelector(".js-cq-AssetToComponentMapper-addMimeType");c=c.value;d.disabled=!1;e.disabled=!1;e=b.dropTargets[0];for(var f=0;f<b.dropTargets.length;f++)if(c===
b.dropTargets[f].name){e=b.dropTargets[f];break}if(e&&(d.items.clear(),e.accept)){var g=a.dataset.name;e.accept.forEach(function(a){d.items.add({content:{htmlContent:(new Coral.Textfield).set({name:"./cq:authoring/assetToComponentMapping/"+g})}}).querySelector("input[type\x3d'text']").value=a})}}}function q(b){b=b.target;var c=b.closest(".js-cq-AssetToComponentMapper-mapping"),d=c.querySelector(".js-cq-AssetToComponentMapper-assetGroup"),e=c.querySelector(".js-cq-AssetToComponentMapper-resourceType").value;
e=G[e];for(var f,g=0;g<e.dropTargets.length;g++)if(b.value===e.dropTargets[g].name){f=e.dropTargets[g];break}d&&f&&a(d,f);c&&e&&b&&k(c,e)}var F,w,D,G={},H={};h.on("dialog-loaded",function(a){F=a.dialog[0];if(w=F.querySelector(".js-cq-AssetToComponentMapper")){var d=w.closest("coral-tabview");Coral.commons.ready(d,function(){d.on("coral-panelstack:change",function(a){if(a.detail.selection&&a.detail.selection.contains(w)){a=F.querySelectorAll(".js-cq-AllowedComponents-component input[type\x3d'checkbox']:checked");
H={};for(var b=0;b<a.length;b++){var c=a[b].closest(".js-cq-AllowedComponents-component");c&&(H[c.dataset.resourceType]=G[c.dataset.resourceType])}if(D=w.querySelectorAll(".js-cq-AssetToComponentMapper-resourceType"))for(a=0,b=D.length;a<b;a++)e(D[a])}})});D=w.querySelectorAll(".js-cq-AssetToComponentMapper-resourceType");a=F.querySelector(".js-cq-AssetToComponentMapper-addMapping");var g=JSON.parse(w.dataset.dropTargets);g&&(G=g.componentDropTargets||{});a.on("click",f);w.on("click",".js-cq-AssetToComponentMapper-deleteMapping",
b);c(w).on("change",".js-cq-AssetToComponentMapper-resourceType",n);c(w).on("change",".js-cq-AssetToComponentMapper-dropTarget",q)}})})(jQuery,Granite.author,jQuery(document),this);